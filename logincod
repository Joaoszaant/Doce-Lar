 <?php
session_start();
require_once '../MODEL/usuario.php'; // ajuste o caminho conforme sua estrutura

//$usuario = new suario();
$mensagem = "";

// ====== LOGIN ======
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['loginUsuario'])) {
    $email = trim(string: $_POST['loginUsuario']);
    $senha = $_POST['loginSenha'];

    $usuario = $usuarioDAO->login($email, $senha);

    if ($usuario) {
        $_SESSION['usuario'] = $usuario;
        echo "<script>alert('Login realizado com sucesso!'); window.location.href='home.html';</script>";
        exit;
    } else {
        $mensagem = "❌ Usuário ou senha incorretos.";
    }
}

// ====== CADASTRO ======
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['nome']) && isset($_POST['email'])) {
    $nome = trim(string: $_POST['nome']);
    $email = trim(string: $_POST['email']);
    $senha = $_POST['senha'];
    $confirmarSenha = $_POST['confirmarSenha'];
    $telefone = $_POST['telefone'];
    $cidade = $_POST['Cidade'];
    $estado = $_POST['estado'];
    $tipo_usuario = 'Adotante'; // padrão

    if ($senha !== $confirmarSenha) {
        $mensagem = "⚠️ As senhas não coincidem!";
    } else {
        $sucesso = $usuarioDAO->cadastrar($nome, $email, $senha, $telefone, $cidade, $estado, $tipo_usuario);
        if ($sucesso) {
            echo "<script>alert('Cadastro realizado com sucesso!'); window.location.href='login.php';</script>";

        } else {
            $mensagem = "❌ Erro ao cadastrar. E-mail já pode estar sendo usado.";
        }
    }
}
?>

<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login / Cadastro - Doce Lar</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">

        <?php if (!empty($mensagem)): ?>
            <div style="background-color: #ffe0e0; border: 1px solid #ffb3b3; padding: 10px; color: #b30000; border-radius: 5px; text-align:center; margin-bottom:15px;">
                <?= $mensagem ?>
            </div>
        <?php endif; ?>

        <!-- Área de Login -->
        <div id="login">
            <h2>Login</h2>
            
                <form id="loginForm" method="post" action="../MODEL/processa_login.php">
    <label for="loginUsuario">E-mail:</label>
    <input type="email" id="loginUsuario" name="loginUsuario" required>

    <label for="loginSenha">Senha:</label>
    <input type="password" id="loginSenha" name="loginSenha" required>

    <button type="submit">Entrar</button>
</form>
<p>Ainda não tem uma conta? <a href="#" id="switchToSignup">Cadastre-se aqui</a></p>

        <!-- Área de Cadastro -->
        <div id="signup" style="display: none;">
            <h2>Cadastro</h2>
                <form id="signupForm" method="post" action="../MODEL/processa_cadastro.php">
                <label for="nome">Nome:</label>
                <input type="text" id="nome" name="nome" required>

                <label for="email">E-mail:</label>
                <input type="email" id="email" name="email" required>

                <label for="estado">Estado:</label>
                <select name="estado" id="estado" required> 
                    <option value="">Selecione o Estado</option> 
                    <option value="AC">Acre</option> 
                    <option value="AL">Alagoas</option> 
                    <option value="AM">Amazonas</option> 
                    <option value="AP">Amapá</option> 
                    <option value="BA">Bahia</option> 
                    <option value="CE">Ceará</option> 
                    <option value="DF">Distrito Federal</option> 
                    <option value="ES">Espírito Santo</option> 
                    <option value="GO">Goiás</option> 
                    <option value="MA">Maranhão</option> 
                    <option value="MT">Mato Grosso</option> 
                    <option value="MS">Mato Grosso do Sul</option> 
                    <option value="MG">Minas Gerais</option> 
                    <option value="PA">Pará</option> 
                    <option value="PB">Paraíba</option> 
                    <option value="PR">Paraná</option> 
                    <option value="PE">Pernambuco</option> 
                    <option value="PI">Piauí</option> 
                    <option value="RJ">Rio de Janeiro</option> 
                    <option value="RN">Rio Grande do Norte</option> 
                    <option value="RO">Rondônia</option> 
                    <option value="RS">Rio Grande do Sul</option> 
                    <option value="RR">Roraima</option> 
                    <option value="SC">Santa Catarina</option> 
                    <option value="SE">Sergipe</option> 
                    <option value="SP">São Paulo</option> 
                    <option value="TO">Tocantins</option> 
                </select>

                <label for="endereco">Cidade:</label>
                <input type="text" id="endereco" name="Cidade" required>

                <label for="telefone">Telefone:</label>
                <input type="tel" id="telefone" name="telefone" required>

                <label for="senha">Senha:</label>
                <input type="password" id="senha" name="senha" required>

                <label for="confirmarSenha">Confirmar senha:</label>
                <input type="password" id="confirmarSenha" name="confirmarSenha" required>

                <button type="submit">Cadastrar</button>
            </form>
            <p>Já tem uma conta? <a href="#" id="switchToLogin">Entre aqui</a></p>
        </div>

    </div>

    <script src="script.js"></script>
    <script>
document.getElementById("switchToSignup").addEventListener("click", function(e) {
  e.preventDefault();
  document.getElementById("login").style.display = "none";
  document.getElementById("signup").style.display = "block";
});

document.getElementById("switchToLogin").addEventListener("click", function(e) {
  e.preventDefault();
  document.getElementById("signup").style.display = "none";
  document.getElementById("login").style.display = "block";
});
</script>

</body>
</html>
//